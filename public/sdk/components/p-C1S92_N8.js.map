{"file":"p-C1S92_N8.js","mappings":"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","names":["scopedUrlAlphabet","__stencil_proxyCustomElement","HTMLElement"],"sources":["node_modules/nanoid/url-alphabet/index.js","node_modules/nanoid/index.browser.js","src/components/searchcraft-ad/searchcraft-ad.tsx"],"sourcesContent":["export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n","/* @ts-self-types=\"./index.d.ts\" */\nimport { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << Math.log2(alphabet.length - 1)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step | 0\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length >= size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size | 0, random)\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array((size |= 0)))\n  while (size--) {\n    id += scopedUrlAlphabet[bytes[size] & 63]\n  }\n  return id\n}\n","import { Component, Element, Prop, State, h } from '@stencil/core';\nimport type { ADMClientResponseItem, AdClientResponseItem } from '@types';\nimport classNames from 'classnames';\nimport { nanoid } from 'nanoid';\n\nimport type { SearchcraftState } from '@store';\n\nimport type { SearchcraftCore } from '@classes';\nimport { registry } from '@classes/CoreInstanceRegistry';\nimport { html } from '@utils';\n\n/**\n * An inline ad meant to be rendered in a list of search results.\n *\n * @internal\n */\n@Component({\n  tag: 'searchcraft-ad',\n  shadow: false,\n})\nexport class SearchcraftPopoverListItemAd {\n  /**\n   * The id of the Searchcraft instance that this component should use.\n   */\n  @Prop() searchcraftId?: string;\n  @Prop() adSource: 'Custom' | 'Nativo' | 'adMarketplace' = 'Custom';\n  @Prop() adClientResponseItem?: AdClientResponseItem;\n\n  /**\n   * Where the ad is being rendered within the search results div.\n   * Lifecycle behavior differs for ads being rendered in different positions,\n   * so we need to be able to handle all of those cases.\n   */\n  @Prop() renderPosition: 'interstitial' | 'top' | 'bottom' = 'interstitial';\n\n  @State() searchTerm?: string;\n  @State() isSearchInProgress = false;\n  @State() searchResultCount = 0;\n  @Element() hostElement?: HTMLElement;\n\n  private core?: SearchcraftCore;\n\n  private intersectionObserver?: IntersectionObserver;\n  private storeUnsubscribe?: () => void;\n  private cleanupCore?: () => void;\n  private adContainerRenderedTimeout?: NodeJS.Timeout;\n  private isComponentConnected = false;\n  private timeTaken?: number;\n\n  @State() adContainerId = '';\n\n  /**\n   * Handles when an ad container is first rendered.\n   * Core emits an ad_container_rendered event and performs ad client side effects\n   *\n   */\n  handleAdRendered() {\n    this.adContainerId = nanoid();\n\n    if (this.isComponentConnected && this.searchResultCount > 0) {\n      clearTimeout(this.adContainerRenderedTimeout);\n      this.adContainerRenderedTimeout = setTimeout(() => {\n        this.core?.handleAdContainerRendered({\n          adClientResponseItem: this.adClientResponseItem,\n          adContainerId: this.adContainerId,\n          searchTerm: this.searchTerm || '',\n        });\n      }, this.core?.config?.customAdConfig?.adContainerRenderedDebounceDelay ||\n        300);\n    }\n  }\n\n  handleAdViewed() {\n    this.core?.handleAdContainerViewed({\n      adClientResponseItem: this.adClientResponseItem,\n      adContainerId: this.adContainerId,\n      searchTerm: this.searchTerm || '',\n    });\n  }\n\n  /**\n   * Things to do when there's a new incoming search request.\n   */\n  handleNewIncomingSearchRequest(state: SearchcraftState) {\n    const requestProperties = state.searchClientRequestProperties;\n    if (requestProperties && typeof requestProperties === 'object') {\n      this.searchTerm = requestProperties.searchTerm;\n    }\n\n    this.searchResultCount = state.searchClientResponseItems.length;\n\n    this.handleAdRendered();\n\n    this.startIntersectionObserver();\n  }\n\n  onCoreAvailable(core: SearchcraftCore) {\n    const currentState = core.store.getState();\n\n    this.isComponentConnected = true;\n    this.core = currentState.core;\n    this.isSearchInProgress = currentState.isSearchInProgress;\n    this.searchResultCount = currentState.searchClientResponseItems.length;\n    this.timeTaken = currentState.searchResponseTimeTaken;\n\n    const requestProperties = currentState.searchClientRequestProperties;\n    if (requestProperties && typeof requestProperties === 'object') {\n      this.searchTerm = requestProperties.searchTerm;\n    }\n\n    /**\n     * Interstial ads have a different lifecycle, where we need handle an incoming search\n     * request immediately, because they are rendered alongside the search results.\n     */\n    if (this.renderPosition === 'interstitial') {\n      this.handleNewIncomingSearchRequest(currentState);\n    }\n\n    // Subscribes to store changes (for search term).\n    this.storeUnsubscribe = core.store.subscribe((state) => {\n      if (this.timeTaken !== state.searchResponseTimeTaken) {\n        this.handleNewIncomingSearchRequest(state);\n      }\n      this.timeTaken = state.searchResponseTimeTaken;\n      this.isSearchInProgress = state.isSearchInProgress;\n    });\n  }\n\n  connectedCallback() {\n    this.cleanupCore = registry.useCoreInstance(\n      this.searchcraftId,\n      this.onCoreAvailable.bind(this),\n    );\n  }\n\n  startIntersectionObserver() {\n    this.intersectionObserver?.disconnect();\n    /**\n     * Handles when an ad container is viewable within the document,\n     * Core emits an ad_container_viewed event and performs ad client side effects\n     */\n    if (this.hostElement) {\n      this.intersectionObserver = new IntersectionObserver(\n        ([entry]) => {\n          if (entry?.isIntersecting && this.searchResultCount > 0) {\n            this.handleAdViewed();\n          }\n        },\n        { threshold: 0 },\n      );\n\n      this.intersectionObserver.observe(this.hostElement);\n    }\n  }\n\n  disconnectedCallback() {\n    this.storeUnsubscribe?.();\n    this.cleanupCore?.();\n    this.intersectionObserver?.disconnect();\n    this.isComponentConnected = false;\n    clearTimeout(this.adContainerRenderedTimeout);\n  }\n\n  renderADMAd() {\n    const item = this.adClientResponseItem as ADMClientResponseItem;\n\n    if (!item.admAd) {\n      return;\n    }\n\n    let templateHtml = '<p>Ad Marketplace Ad Placeholder</p>';\n\n    if (this.core?.config?.admAdConfig?.template) {\n      templateHtml = this.core?.config?.admAdConfig.template(item.admAd, {\n        html,\n      });\n    }\n\n    return (\n      <div\n        class='searchcraft-ad searchcraft-adm-ad'\n        data-searchcraft-ad-container-id={this.adContainerId}\n        id={`searchcraft-adm-ad-${this.adContainerId}`}\n        innerHTML={templateHtml}\n      />\n    );\n  }\n\n  renderCustomAd() {\n    const templateRenderFunction = this.core?.config?.customAdConfig?.template;\n    const containerId = `searchcraft-custom-ad-${this.adContainerId}`;\n    let templateHtml = '<p>Custom Ad Placeholder</p>';\n\n    if (templateRenderFunction) {\n      templateHtml = templateRenderFunction(\n        {\n          searchTerm: this.searchTerm || '',\n          adContainerId: this.adContainerId,\n        },\n        { html },\n      );\n    }\n\n    return (\n      <div\n        class='searchcraft-ad searchcraft-custom-ad'\n        id={containerId}\n        data-searchcraft-ad-container-id={this.adContainerId}\n        innerHTML={templateHtml}\n      />\n    );\n  }\n\n  renderNativoAd() {\n    const nativoClassName =\n      this.core?.config.nativoConfig?.adClassName || 'ntv-item';\n    return (\n      <div\n        id={`searchcraft-native-ad-${this.adContainerId}`}\n        class={classNames('searchcraft-ad', nativoClassName)}\n        data-searchcraft-ad-container-id={this.adContainerId}\n      />\n    );\n  }\n\n  render() {\n    // Don't render ads if no search results\n    if (this.searchResultCount === 0) {\n      return;\n    }\n\n    switch (this.adSource) {\n      case 'adMarketplace':\n        return this.renderADMAd();\n      case 'Custom':\n        return this.renderCustomAd();\n      case 'Nativo':\n        return this.renderNativoAd();\n      default:\n        return;\n    }\n  }\n}\n"],"version":3}