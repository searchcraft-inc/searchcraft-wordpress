{"file":"CoreInstanceRegistry.js","mappings":"AAEA;;;AAGG;AACI,MAAM,wBAAwB,GAAG;AAExC;;;;;;AAMG;AACH,MAAM,oBAAoB,CAAA;IAChB,aAAa,GAAoC,EAAE;IACnD,aAAa,GACnB,EAAE;AAEJ;;;;;;;;AAQG;IACH,eAAe,CACb,YAA6B,EAC7B,aAAiC,EAAA;AAEjC,QAAA,MAAM,EAAE,GAAG,aAAa,IAAI,wBAAwB;AACpD,QAAA,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,YAAY;AAErC,QAAA,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE;YACnD,QAAQ,CAAC,YAAY,CAAC;;;AAI1B;;;;;;AAMG;IACH,eAAe,CACb,aAAiC,EACjC,WAAoD,EAAA;AAEpD,QAAA,MAAM,EAAE,GAAG,aAAa,IAAI,wBAAwB;;AAEpD,QAAA,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;YAC1B,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;AACnC,YAAA,OAAO,MAAO,GAAC;;;QAGjB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;AAC3B,YAAA,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,EAAE;;QAE7B,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;AAExC,QAAA,OAAO,MAAK;AACV,YAAA,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;gBAC1B,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,MAAM,CACpD,CAAC,EAAE,KAAK,EAAE,KAAK,WAAW,CAC3B;;AAEL,SAAC;;AAEJ;AAEY,MAAA,QAAQ,GAAG,IAAI,oBAAoB;;;;","names":[],"sources":["src/classes/CoreInstanceRegistry.ts"],"sourcesContent":["import type { SearchcraftCore } from '@classes';\n\n/**\n * This is the default instance id for searchcraft core instances.\n * When no id is specified in a component's props, use this one.\n */\nexport const DEFAULT_CORE_INSTANCE_ID = 'searchcraft';\n\n/**\n * CoreInstanceRegistry\n *\n * This class is responsible for managing all of the instances of SearchcraftCore on a page.\n * It provides a means for consuming components to use the instance of SearchcraftCore that\n * they need to use when that instance of core gets added to the Registry.\n */\nclass CoreInstanceRegistry {\n  private coreInstances: Record<string, SearchcraftCore> = {};\n  private subscriptions: Record<string, ((core: SearchcraftCore) => void)[]> =\n    {};\n\n  /**\n   * Adds a SearchcraftCore instance to the Registry.\n   *\n   * When the instance is added, iterates through the onAvailable callbacks\n   * that have been subscribed via useCoreInstance.\n   *\n   * @param coreInstance The SearchcraftCore instance to add to the registry\n   * @param searchcraftId The unique identifier for this SearchcraftCore instance.\n   */\n  addCoreInstance(\n    coreInstance: SearchcraftCore,\n    searchcraftId: string | undefined,\n  ) {\n    const id = searchcraftId || DEFAULT_CORE_INSTANCE_ID;\n    this.coreInstances[id] = coreInstance;\n\n    for (const callback of this.subscriptions[id] || []) {\n      callback(coreInstance);\n    }\n  }\n\n  /**\n   * Use the specified instance of SearchcraftCore. When the instance becomes available,\n   * the onAvailable callback will be called.\n   *\n   * @param searchcraftId The SearchcraftCore instance to use.\n   * @param onAvailable The callback that gets called when the core instance becomes available.\n   */\n  useCoreInstance(\n    searchcraftId: string | undefined,\n    onAvailable: (coreInstance: SearchcraftCore) => void,\n  ): () => void {\n    const id = searchcraftId || DEFAULT_CORE_INSTANCE_ID;\n    // If the core instance already is available, call the onAvailable callback immediately.\n    if (this.coreInstances[id]) {\n      onAvailable(this.coreInstances[id]);\n      return () => {};\n    }\n    // Add the callback to the collection of callbacks for this searchcraft instance.\n    if (!this.subscriptions[id]) {\n      this.subscriptions[id] = [];\n    }\n    this.subscriptions[id].push(onAvailable);\n\n    return () => {\n      if (this.subscriptions[id]) {\n        this.subscriptions[id] = this.subscriptions[id].filter(\n          (cb) => cb !== onAvailable,\n        );\n      }\n    };\n  }\n}\n\nexport const registry = new CoreInstanceRegistry();\n"],"version":3}