{"file":"p-BV4HUriZ.js","mappings":"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","names":["__stencil_proxyCustomElement","HTMLElement"],"sources":["src/utils/facets.ts","src/components/searchcraft-facet-list/searchcraft-facet-list.tsx"],"sourcesContent":["import type {\n  Facet,\n  FacetTree,\n  FacetWithChildrenArray,\n  FacetWithChildrenObject,\n} from '@types';\n\n/**\n * Helper function for getting a Node (FacetWithChildrenObject)\n * at a given path. Traverses the node tree to get the node.\n */\nexport const getFacetTreeNodeAtPath = (\n  tree: FacetTree,\n  nodePaths: string[],\n): FacetWithChildrenObject | undefined => {\n  let cursor: FacetWithChildrenObject | undefined = tree;\n  for (const nodePath of nodePaths) {\n    cursor = cursor?.children[nodePath];\n  }\n\n  return cursor;\n};\n\n/**\n * Helper function to perform a deep merge.\n * Used for merging two branches of a facet tree together.\n */\nexport const deepMergeWithSpread = (obj1, obj2) => {\n  const result = { ...obj1 };\n\n  for (const key in obj2) {\n    // biome-ignore lint/suspicious/noPrototypeBuiltins: <explanation>\n    if (obj2.hasOwnProperty(key)) {\n      if (obj2[key] instanceof Object && obj1[key] instanceof Object) {\n        result[key] = deepMergeWithSpread(obj1[key], obj2[key]);\n      } else {\n        result[key] = obj2[key];\n      }\n    }\n  }\n\n  return result;\n};\n\n/**\n * Given an array of facet paths, removes parent facet paths so that only the\n * Leaf facets are sent with the search request.\n */\nexport function removeSubstringMatches(arr: string[]): string[] {\n  return arr.filter(\n    (entry, index, array) =>\n      !array.some(\n        (otherEntry, otherIndex) =>\n          otherIndex !== index && otherEntry.includes(entry),\n      ),\n  );\n}\n\n/**\n * Merges a current facet tree with an incoming facet tree.\n *\n * At each branch, the incoming facet tree's facets override current facet tree\n *\n * @param currentTree\n * @param incomingTree\n */\nexport const mergeFacetTrees = (\n  currentTree: FacetTree,\n  incomingTree: FacetTree,\n): FacetTree => {\n  const mergedTree: FacetTree = structuredClone(currentTree);\n\n  const merge = (\n    currentBranch: FacetWithChildrenObject,\n    nodePath: string[],\n  ): FacetWithChildrenObject => {\n    const mergedBranch = structuredClone(currentBranch);\n    const incomingBranch = getFacetTreeNodeAtPath(incomingTree, nodePath);\n\n    if (!incomingBranch) {\n      return mergedBranch;\n    }\n\n    for (const nodeName of Object.keys(currentBranch.children)) {\n      if (incomingBranch.children[nodeName]) {\n        mergedBranch.children[nodeName] = {\n          ...deepMergeWithSpread(\n            currentBranch.children[nodeName],\n            incomingBranch.children[nodeName],\n          ),\n          count: mergedBranch.children[nodeName]?.count || 0,\n        };\n      } else if (mergedBranch.children[nodeName]) {\n        mergedBranch.children[nodeName] = merge(\n          mergedBranch.children[nodeName],\n          [...nodePath, nodeName],\n        );\n      }\n    }\n\n    return mergedBranch;\n  };\n\n  return merge(mergedTree, []);\n};\n\n/**\n * A function that converts a FacetWithChidrenArray to a complete FacetTree object.\n *\n * It uses the `path` of each Facet to build the tree.\n *\n * @param facetWithChildArray\n * @param exclude - Optional array of facet values or paths to exclude from the tree.\n *                  - Values starting with \"/\" are treated as full paths and exclude the path and all children\n *                    (e.g., \"/news\" excludes \"/news\", \"/news/local\", \"/news/national\", etc.)\n *                  - Values without \"/\" are treated as segment names (e.g., \"local\" excludes all paths containing \"local\")\n */\nexport const facetWithChildrenArrayToCompleteFacetTree = (\n  rootArray: FacetWithChildrenArray,\n  exclude?: string[],\n): FacetTree => {\n  // 1) Start with an empty tree at root \"/\"\n  const tree: FacetTree = {\n    path: '/',\n    count: 0,\n    children: {},\n  };\n\n  // 2) Recursively collect all nodes except the implicit \"/\" itself\n  const allFacets: Facet[] = [];\n  const collect = (node: FacetWithChildrenArray) => {\n    if (node.path !== '/') {\n      allFacets.push({ path: node.path, count: node.count });\n    }\n    if (node.children) {\n      for (const child of node.children) {\n        collect(child);\n      }\n    }\n  };\n  collect(rootArray);\n\n  // 3) Insert each flat node into our tree, creating missing ancestors\n  for (const { path, count } of allFacets) {\n    const segments = path.split('/').filter(Boolean); // \"/sports/outdoors\" -> [\"sports\",\"outdoors\"]\n\n    // Skip this facet if it matches any excluded value\n    if (exclude && exclude.length > 0) {\n      let shouldExclude = false;\n\n      for (const excludeValue of exclude) {\n        if (excludeValue.startsWith('/')) {\n          // Full path exclusion: prefix match (excludes the path and all children)\n          if (path === excludeValue || path.startsWith(`${excludeValue}/`)) {\n            shouldExclude = true;\n            break;\n          }\n        } else {\n          // Segment exclusion: check if any segment matches\n          if (segments.includes(excludeValue)) {\n            shouldExclude = true;\n            break;\n          }\n        }\n      }\n\n      if (shouldExclude) {\n        continue;\n      }\n    }\n\n    let cursor: FacetWithChildrenObject = tree; // start at the root\n    for (const segment of segments) {\n      // Build the full path of this level\n      const prefixPath =\n        cursor.path === '/' ? `/${segment}` : `${cursor.path}/${segment}`;\n\n      // If this segment doesn't exist yet, create it\n      if (!cursor.children[segment]) {\n        cursor.children[segment] = {\n          path: prefixPath,\n          count: count,\n          children: {},\n        };\n      }\n\n      // Descend to the next level deeper\n      cursor = cursor.children[segment];\n    }\n\n    // 4) Now `cursor` is the node matching `path` assign its real count\n    cursor.count = count;\n  }\n\n  return tree;\n};\n","import {\n  Component,\n  Event,\n  type EventEmitter,\n  Prop,\n  State,\n  h,\n} from '@stencil/core';\n\nimport type {\n  FacetRoot,\n  FacetWithChildrenArray,\n  FacetWithChildrenObject,\n  SearchClientQuery,\n} from '@types';\n\nimport type { SearchcraftCore } from '@classes';\nimport { registry } from '@classes/CoreInstanceRegistry';\nimport type { SearchcraftState } from '@store';\nimport {\n  deepMergeWithSpread,\n  facetWithChildrenArrayToCompleteFacetTree,\n  getFacetTreeNodeAtPath,\n  mergeFacetTrees,\n  removeSubstringMatches,\n} from '@utils';\n\ntype HandlerActionType =\n  | 'SEARCH_TERM_EMPTY'\n  | 'NEW_SEARCH_TERM'\n  | 'NEW_SEARCH_TERM_WHILE_FACETS_ACTIVE'\n  | 'RANGE_VALUE_UPDATE'\n  | 'EXACT_MATCH_UPDATE'\n  | 'SORT_ORDER_UPDATE'\n  | 'FACET_UPDATE'\n  | 'UNKNOWN';\n\n/**\n * This web component is designed to display facets in a search interface, allowing users to refine their search results by applying filters based on various attributes.\n * It is consumed within the `searchcraft-filter-panel`.\n *\n * @js-example\n * ```html\n * <!-- index.html -->\n * <searchcraft-facet-list field-name=\"title\" />\n * ```\n *\n * ```js\n * // index.js\n * const facetList = document.querySelector('searchcraft-facet-list');\n *\n * facetList.addEventListener('facetSelectionUpdated', () => {\n *   console.log('Facet selection updated');\n * });\n * ```\n *\n * @internal\n */\n@Component({\n  tag: 'searchcraft-facet-list',\n  shadow: false,\n})\nexport class SearchcraftFacetList {\n  /**\n   * The id of the Searchcraft instance that this component should use.\n   */\n  @Prop() searchcraftId?: string;\n  /**\n   * The name of the field where facets are applied.\n   */\n  @Prop() fieldName = '';\n  /**\n   * Array of facet values to exclude from rendering.\n   */\n  @Prop() exclude?: string[];\n\n  /**\n   * Emitted when the facets are updated.\n   */\n  @Event() facetSelectionUpdated?: EventEmitter<{ paths: string[] }>;\n\n  /**\n   * The currently selected facet paths.\n   */\n  @State() selectedPaths: Record<string, boolean> = {};\n\n  /**\n   * A Tree representing all of the facets collected from search responses.\n   */\n  @State() facetTreeCollectedFromSearchResponse: FacetWithChildrenObject = {\n    path: '/',\n    count: 0,\n    children: {},\n  };\n\n  /**\n   * A Tree representing the facet paths that are selected, but were not included\n   * in any search response.\n   */\n  facetTreeFromFacetPathsNotInSearchResponse: FacetWithChildrenObject = {\n    path: '/',\n    count: 0,\n    children: {},\n  };\n\n  /**\n   * The facet tree that ultimately gets rendered.\n   * This is a mergin of the facetTreeCollectedFromSearchResponse and the facetTreeFromFacetPathsNotInSearchResponse tree\n   */\n  @State() renderedFacetTree: FacetWithChildrenObject = {\n    path: '/',\n    count: 0,\n    children: {},\n  };\n\n  // Internal vars used to track when to perform various facet actions.\n  private lastTimeTaken?: number;\n  private lastSearchTerm?: string;\n  private lastSearchMode?: string;\n  private lastSortType?: string | null;\n  private lastRangeValues?: string;\n  private lastFacetValues?: string;\n\n  private unsubscribe?: () => void;\n  private cleanupCore?: () => void;\n\n  get areAnyFacetPathsSelected(): boolean {\n    return Object.keys(this.selectedPaths).some(\n      (key) => this.selectedPaths[key],\n    );\n  }\n\n  handleIncomingSearchResponse(\n    state: SearchcraftState,\n    actionType: HandlerActionType,\n  ) {\n    // Look at the incoming facet root from the search response, and convert it to a FacetTree\n    const incomingFacetRoot: FacetRoot | undefined =\n      state.searchResponseFacetPrime?.find(\n        (facet) => this.fieldName === Object.keys(facet)[0],\n      );\n    const incomingFacetsWithChildrenArray = incomingFacetRoot?.[this.fieldName];\n    const incomingFacetTree = facetWithChildrenArrayToCompleteFacetTree(\n      {\n        path: '/',\n        count: 0,\n        children: incomingFacetsWithChildrenArray || [],\n      },\n      this.exclude,\n    );\n\n    // Determine what action to take to accumulate items into the `facetTreeCollectedFromSearchResponse`.\n    // This facet tree gets accumulated in different ways depending on what action type occured.\n    switch (actionType) {\n      case 'SEARCH_TERM_EMPTY':\n        this.facetTreeCollectedFromSearchResponse = {\n          path: '/',\n          count: 0,\n          children: {},\n        };\n        break;\n      case 'NEW_SEARCH_TERM':\n        this.facetTreeCollectedFromSearchResponse = incomingFacetTree;\n        break;\n      case 'NEW_SEARCH_TERM_WHILE_FACETS_ACTIVE':\n      case 'EXACT_MATCH_UPDATE':\n      case 'RANGE_VALUE_UPDATE': {\n        if (state.supplementalFacetPrime) {\n          const supplementalFacetRoot: FacetRoot | undefined =\n            state.supplementalFacetPrime?.find(\n              (facet) => this.fieldName === Object.keys(facet)[0],\n            );\n          const supplementalFacetsWithChildrenArray =\n            supplementalFacetRoot?.[this.fieldName];\n          const supplementalFacetTree =\n            facetWithChildrenArrayToCompleteFacetTree(\n              {\n                path: '/',\n                count: 0,\n                children: supplementalFacetsWithChildrenArray || [],\n              },\n              this.exclude,\n            );\n\n          this.facetTreeCollectedFromSearchResponse = mergeFacetTrees(\n            supplementalFacetTree,\n            incomingFacetTree,\n          );\n        } else {\n          this.facetTreeCollectedFromSearchResponse = incomingFacetTree;\n        }\n        break;\n      }\n      case 'FACET_UPDATE':\n      case 'SORT_ORDER_UPDATE':\n        this.facetTreeCollectedFromSearchResponse = mergeFacetTrees(\n          this.facetTreeCollectedFromSearchResponse,\n          incomingFacetTree,\n        );\n        break;\n      default:\n        return;\n    }\n\n    // Determine if there are any selected facet paths not in the current tree.\n    // If there are, we add them to \"facetTreeFromFacetPathsNotInSearchResponse\"\n    this.facetTreeFromFacetPathsNotInSearchResponse = {\n      path: '/',\n      count: 0,\n      children: {},\n    };\n    const collectedFacetArray: FacetWithChildrenArray = {\n      path: '/',\n      count: 0,\n      children: [],\n    };\n    for (const pathName of Object.keys(this.selectedPaths).filter(\n      (path) => this.selectedPaths[path],\n    )) {\n      const nodePaths = pathName.startsWith('/')\n        ? pathName.substring(1).split('/')\n        : pathName.split('/');\n\n      const wasFoundInFacetTree = !!getFacetTreeNodeAtPath(\n        this.facetTreeCollectedFromSearchResponse,\n        nodePaths,\n      );\n\n      const pathKeyName = nodePaths.at(-1);\n      if (!wasFoundInFacetTree && pathKeyName) {\n        collectedFacetArray.children?.push({\n          children: [],\n          count: 0,\n          path: pathName,\n        });\n      }\n    }\n    this.facetTreeFromFacetPathsNotInSearchResponse =\n      facetWithChildrenArrayToCompleteFacetTree(\n        collectedFacetArray,\n        this.exclude,\n      );\n\n    // Merges facetTreeCollectedFromSearchResponse with selectedFacetPathsNotInCurrentFacetTree.\n    // This results in a single, final facet tree that gets rendered in as Checkboxes\n    this.renderedFacetTree = deepMergeWithSpread(\n      this.facetTreeFromFacetPathsNotInSearchResponse,\n      this.facetTreeCollectedFromSearchResponse,\n    );\n  }\n\n  handleStateUpdate(_state: SearchcraftState) {\n    const state = { ..._state };\n    // Determine what action to take based on the current State\n\n    // Check if this is an initialQuery case (string requestProperties with empty searchTerm)\n    const isInitialQuery =\n      typeof state.searchClientRequestProperties === 'string' &&\n      state.searchTerm.trim() === '';\n\n    if (state.searchTerm.trim() === '' && !isInitialQuery) {\n      this.handleIncomingSearchResponse(state, 'SEARCH_TERM_EMPTY');\n      this.lastSearchTerm = '';\n    } else if (\n      this.lastTimeTaken !== state.searchResponseTimeTaken &&\n      state.searchClientRequestProperties\n    ) {\n      // Handle both object and string requestProperties (string is used for initialQuery)\n      if (typeof state.searchClientRequestProperties === 'object') {\n        const requestProperties = state.searchClientRequestProperties;\n        let actionType: HandlerActionType = 'UNKNOWN';\n\n        if (this.lastSearchTerm !== requestProperties.searchTerm) {\n          if (this.areAnyFacetPathsSelected) {\n            actionType = 'NEW_SEARCH_TERM_WHILE_FACETS_ACTIVE';\n          } else {\n            actionType = 'NEW_SEARCH_TERM';\n          }\n        } else if (\n          this.lastRangeValues !==\n          JSON.stringify(requestProperties.rangeValueForIndexFields)\n        ) {\n          actionType = 'RANGE_VALUE_UPDATE';\n        } else if (\n          this.lastFacetValues !==\n          JSON.stringify(requestProperties.facetPathsForIndexFields)\n        ) {\n          actionType = 'FACET_UPDATE';\n        } else if (this.lastSortType !== requestProperties.order_by) {\n          actionType = 'SORT_ORDER_UPDATE';\n        } else if (this.lastSearchMode !== requestProperties.mode) {\n          actionType = 'EXACT_MATCH_UPDATE';\n        }\n\n        this.lastRangeValues = JSON.stringify(\n          requestProperties.rangeValueForIndexFields,\n        );\n        this.lastFacetValues = JSON.stringify(\n          requestProperties.facetPathsForIndexFields,\n        );\n        this.lastSortType = requestProperties.order_by;\n        this.lastSearchMode = requestProperties.mode;\n        this.lastSearchTerm = requestProperties.searchTerm;\n        this.lastTimeTaken = state.searchResponseTimeTaken;\n        // Handle the incoming response, using the action we have determined.\n        this.handleIncomingSearchResponse(state, actionType);\n      } else if (typeof state.searchClientRequestProperties === 'string') {\n        // Handle initialQuery case where requestProperties is a string\n        // For initialQuery, searchTerm will be empty but we still want to show facets\n        let actionType: HandlerActionType = 'NEW_SEARCH_TERM';\n\n        // Parse the request to get facet and range filters from the query array\n        const requestObj = JSON.parse(state.searchClientRequestProperties);\n        const queryArray = Array.isArray(requestObj.query)\n          ? requestObj.query\n          : [requestObj.query];\n\n        // Extract filter queries (those with occur: 'must')\n        const filterQueries = queryArray.filter(\n          (q: SearchClientQuery) => q.occur === 'must',\n        );\n        const currentFilters = JSON.stringify(filterQueries);\n\n        // Determine the action type based on what changed\n        if (\n          this.lastFacetValues !== undefined &&\n          this.lastFacetValues !== currentFilters\n        ) {\n          // Filters have changed (not initial load)\n          actionType = 'FACET_UPDATE';\n        } else if (\n          state.searchTerm.trim() === '' &&\n          this.lastSearchTerm === ''\n        ) {\n          // Initial load or no changes with empty search term\n          actionType = 'NEW_SEARCH_TERM';\n        } else if (this.lastSearchTerm !== state.searchTerm) {\n          // User has typed a new search term after initialQuery\n          if (this.areAnyFacetPathsSelected) {\n            actionType = 'NEW_SEARCH_TERM_WHILE_FACETS_ACTIVE';\n          } else {\n            actionType = 'NEW_SEARCH_TERM';\n          }\n        }\n\n        this.lastFacetValues = currentFilters;\n        this.lastSearchTerm = state.searchTerm;\n        this.lastTimeTaken = state.searchResponseTimeTaken;\n        // Handle the incoming response, using the action we have determined.\n        this.handleIncomingSearchResponse(state, actionType);\n      }\n    }\n  }\n\n  onCoreAvailable(core: SearchcraftCore) {\n    this.handleStateUpdate(core.store.getState());\n\n    this.unsubscribe = core.store.subscribe((state) => {\n      this.handleStateUpdate(state);\n    });\n  }\n\n  connectedCallback() {\n    this.cleanupCore = registry.useCoreInstance(\n      this.searchcraftId,\n      this.onCoreAvailable.bind(this),\n    );\n  }\n\n  disconnectedCallback() {\n    this.unsubscribe?.();\n    this.cleanupCore?.();\n  }\n\n  handleCheckboxChange(path: string) {\n    const isCheckboxChecked = !this.selectedPaths[path];\n\n    if (isCheckboxChecked) {\n      /**\n       * Checkbox Checked: Add to the selectedPaths record\n       * Uses spread operator here so UI updates.\n       */\n      this.selectedPaths = {\n        ...this.selectedPaths,\n        [path]: true,\n      };\n    } else {\n      /**\n       * Checkbox Uncheck: Remove any paths and sub-paths\n       */\n      const updatedPaths = Object.keys(this.selectedPaths).filter(\n        (testPath) => !testPath.includes(path),\n      );\n\n      this.selectedPaths = updatedPaths.reduce(\n        (acc, str) => {\n          acc[str] = true;\n          return acc;\n        },\n        {} as Record<string, boolean>,\n      );\n    }\n\n    /**\n     * Emit the paths array, with parent paths removed.\n     */\n    const paths = Object.keys(this.selectedPaths).filter(\n      (path) => this.selectedPaths[path],\n    );\n    const pathsWithParentPathsRemoved = removeSubstringMatches(paths);\n\n    this.facetSelectionUpdated?.emit({ paths: pathsWithParentPathsRemoved });\n  }\n\n  formatFacetName = (name: string): string => {\n    const label = name.replace(/^\\//, '');\n    return `${label.replace(/-/g, ' ').replace(/\\b\\w/g, (char) => char.toUpperCase())}`;\n  };\n\n  renderFacet(keyName: string, facet: FacetWithChildrenObject) {\n    let isChildSelected = false;\n    for (const path of Object.keys(this.selectedPaths)) {\n      if (\n        this.selectedPaths[path] &&\n        path.startsWith(facet.path) &&\n        path.length > facet.path.length\n      ) {\n        isChildSelected = true;\n      }\n    }\n\n    const isSelected = Object.keys(this.selectedPaths).includes(facet.path);\n\n    const shouldRenderChildren =\n      (Object.keys(facet.children).length > 0 &&\n        (isSelected || isChildSelected)) ||\n      keyName === '@@root';\n\n    return (\n      <div class='searchcraft-facet-list-item'>\n        {keyName !== '@@root' && (\n          <label class='searchcraft-facet-list-checkbox-label'>\n            <div class='searchcraft-facet-list-checkbox-input-wrapper'>\n              <input\n                class='searchcraft-facet-list-checkbox-input'\n                checked={this.selectedPaths[facet.path]}\n                onChange={(_event: Event) => {\n                  this.handleCheckboxChange(facet.path);\n                }}\n                type='checkbox'\n              />\n              {isChildSelected ? (\n                <div class='searchcraft-facet-list-checkbox-input-dash-icon'>\n                  <svg viewBox='0 0 14 3' fill='none'>\n                    <title>Checkbox dash</title>\n                    <line\n                      x1='1.5'\n                      y1='1.5'\n                      x2='12.5'\n                      y2='1.5'\n                      stroke='white'\n                      stroke-width='3'\n                      stroke-linecap='round'\n                    />\n                  </svg>\n                </div>\n              ) : (\n                <div class='searchcraft-facet-list-checkbox-input-check-icon'>\n                  <svg width='16' height='16' viewBox='0 0 16 16' fill='none'>\n                    <title>Checkbox check</title>\n                    <path\n                      d='M13.9999 2L5.74988 10L1.99988 6.36364'\n                      stroke='white'\n                      stroke-width='3'\n                      stroke-linecap='round'\n                      stroke-linejoin='round'\n                    />\n                  </svg>\n                </div>\n              )}\n            </div>\n            <span>\n              {this.formatFacetName(keyName)} ({facet.count})\n            </span>\n          </label>\n        )}\n        {shouldRenderChildren && (\n          <div\n            class='searchcraft-facet-list'\n            style={{\n              paddingLeft: keyName !== '@@root' ? '24px' : '0px',\n              paddingTop: keyName !== '@@root' ? '6px' : '0px',\n            }}\n          >\n            {Object.keys(facet.children).map((key) => {\n              if (facet.children[key]) {\n                return this.renderFacet(key, facet.children[key]);\n              }\n            })}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  render() {\n    if (!this.fieldName) {\n      return;\n    }\n\n    if (\n      Object.keys(this.facetTreeCollectedFromSearchResponse.children).length ===\n        0 &&\n      (this.lastSearchTerm || '').trim().length === 0\n    ) {\n      return;\n    }\n\n    if (\n      Object.keys(this.facetTreeCollectedFromSearchResponse.children).length ===\n        0 &&\n      (this.lastSearchTerm || '').trim().length > 0\n    ) {\n      return (\n        <p class='searchcraft-facet-list-message'>\n          No facets are available for this search query.\n        </p>\n      );\n    }\n\n    return (\n      <div class='searchcraft-facet-list'>\n        {this.renderFacet('@@root', this.renderedFacetTree)}\n      </div>\n    );\n  }\n}\n"],"version":3}