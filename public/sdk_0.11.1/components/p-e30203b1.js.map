{"file":"p-e30203b1.js","mappings":"AAEA;;;;MAIa,wBAAwB,GAAG,cAAc;AAEtD;;;;;;;AAOA,MAAM,oBAAoB;IAChB,aAAa,GAAoC,EAAE,CAAC;IACpD,aAAa,GACnB,EAAE,CAAC;;;;;;;;;;IAWL,eAAe,CACb,YAA6B,EAC7B,aAAiC;QAEjC,MAAM,EAAE,GAAG,aAAa,IAAI,wBAAwB,CAAC;QACrD,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC;QAEtC,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE;YACnD,QAAQ,CAAC,YAAY,CAAC,CAAC;SACxB;KACF;;;;;;;;IASD,eAAe,CACb,aAAiC,EACjC,WAAoD;QAEpD,MAAM,EAAE,GAAG,aAAa,IAAI,wBAAwB,CAAC;;QAErD,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;YAC1B,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,CAAC;YACpC,OAAO,SAAQ,CAAC;SACjB;;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;SAC7B;QACD,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAEzC,OAAO;YACL,IAAI,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,EAAE;gBAC1B,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,MAAM,CACpD,CAAC,EAAE,KAAK,EAAE,KAAK,WAAW,CAC3B,CAAC;aACH;SACF,CAAC;KACH;CACF;MAEY,QAAQ,GAAG,IAAI,oBAAoB;;;;","names":[],"sources":["src/classes/CoreInstanceRegistry.ts"],"sourcesContent":["import type { SearchcraftCore } from '@classes';\n\n/**\n * This is the default instance id for searchcraft core instances.\n * When no id is specified in a component's props, use this one.\n */\nexport const DEFAULT_CORE_INSTANCE_ID = 'searchcraft';\n\n/**\n * CoreInstanceRegistry\n *\n * This class is responsible for managing all of the instances of SearchcraftCore on a page.\n * It provides a means for consuming components to use the instance of SearchcraftCore that\n * they need to use when that instance of core gets added to the Registry.\n */\nclass CoreInstanceRegistry {\n  private coreInstances: Record<string, SearchcraftCore> = {};\n  private subscriptions: Record<string, ((core: SearchcraftCore) => void)[]> =\n    {};\n\n  /**\n   * Adds a SearchcraftCore instance to the Registry.\n   *\n   * When the instance is added, iterates through the onAvailable callbacks\n   * that have been subscribed via useCoreInstance.\n   *\n   * @param coreInstance The SearchcraftCore instance to add to the registry\n   * @param searchcraftId The unique identifier for this SearchcraftCore instance.\n   */\n  addCoreInstance(\n    coreInstance: SearchcraftCore,\n    searchcraftId: string | undefined,\n  ) {\n    const id = searchcraftId || DEFAULT_CORE_INSTANCE_ID;\n    this.coreInstances[id] = coreInstance;\n\n    for (const callback of this.subscriptions[id] || []) {\n      callback(coreInstance);\n    }\n  }\n\n  /**\n   * Use the specified instance of SearchcraftCore. When the instance becomes available,\n   * the onAvailable callback will be called.\n   *\n   * @param searchcraftId The SearchcraftCore instance to use.\n   * @param onAvailable The callback that gets called when the core instance becomes available.\n   */\n  useCoreInstance(\n    searchcraftId: string | undefined,\n    onAvailable: (coreInstance: SearchcraftCore) => void,\n  ): () => void {\n    const id = searchcraftId || DEFAULT_CORE_INSTANCE_ID;\n    // If the core instance already is available, call the onAvailable callback immediately.\n    if (this.coreInstances[id]) {\n      onAvailable(this.coreInstances[id]);\n      return () => {};\n    }\n    // Add the callback to the collection of callbacks for this searchcraft instance.\n    if (!this.subscriptions[id]) {\n      this.subscriptions[id] = [];\n    }\n    this.subscriptions[id].push(onAvailable);\n\n    return () => {\n      if (this.subscriptions[id]) {\n        this.subscriptions[id] = this.subscriptions[id].filter(\n          (cb) => cb !== onAvailable,\n        );\n      }\n    };\n  }\n}\n\nexport const registry = new CoreInstanceRegistry();\n"],"version":3}