{"file":"p-87435aac.js","mappings":"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","names":["scopedUrlAlphabet"],"sources":["../../node_modules/nanoid/url-alphabet/index.js","../../node_modules/nanoid/index.browser.js","src/components/searchcraft-ad/searchcraft-ad.tsx"],"sourcesContent":["export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n","import { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << Math.log2(alphabet.length - 1)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step | 0\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length >= size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size | 0, random)\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array((size |= 0)))\n  while (size--) {\n    id += scopedUrlAlphabet[bytes[size] & 63]\n  }\n  return id\n}\n","import type { AdClientResponseItem, ADMClientResponseItem } from '@types';\nimport { Component, Element, h, Prop, State } from '@stencil/core';\nimport { nanoid } from 'nanoid';\nimport classNames from 'classnames';\n\nimport type { SearchcraftState } from '@store';\n\nimport { html } from '@utils';\nimport type { SearchcraftCore } from '@classes';\nimport { registry } from '@classes/CoreInstanceRegistry';\n\n/**\n * An inline ad meant to be rendered in a list of search results.\n *\n * @internal\n */\n@Component({\n  tag: 'searchcraft-ad',\n  shadow: false,\n})\nexport class SearchcraftPopoverListItemAd {\n  /**\n   * The id of the Searchcraft instance that this component should use.\n   */\n  @Prop() searchcraftId?: string;\n  @Prop() adSource: 'Custom' | 'Nativo' | 'adMarketplace' = 'Custom';\n  @Prop() adClientResponseItem?: AdClientResponseItem;\n\n  /**\n   * Where the ad is being rendered within the search results div.\n   * Lifecycle behavior differs for ads being rendered in different positions,\n   * so we need to be able to handle all of those cases.\n   */\n  @Prop() renderPosition: 'interstitial' | 'top' | 'bottom' = 'interstitial';\n\n  @State() searchTerm?: string;\n  @State() isSearchInProgress = false;\n  @State() searchResultCount = 0;\n  @Element() hostElement?: HTMLElement;\n\n  private core?: SearchcraftCore;\n\n  private intersectionObserver?: IntersectionObserver;\n  private storeUnsubscribe?: () => void;\n  private cleanupCore?: () => void;\n  private adContainerRenderedTimeout?: NodeJS.Timeout;\n  private isComponentConnected = false;\n  private timeTaken?: number;\n\n  @State() adContainerId = '';\n\n  /**\n   * Handles when an ad container is first rendered.\n   * Core emits an ad_container_rendered event and performs ad client side effects\n   *\n   */\n  handleAdRendered() {\n    this.adContainerId = nanoid();\n\n    if (this.isComponentConnected && this.searchResultCount > 0) {\n      clearTimeout(this.adContainerRenderedTimeout);\n      this.adContainerRenderedTimeout = setTimeout(() => {\n        this.core?.handleAdContainerRendered({\n          adClientResponseItem: this.adClientResponseItem,\n          adContainerId: this.adContainerId,\n          searchTerm: this.searchTerm || '',\n        });\n      }, this.core?.config?.customAdConfig?.adContainerRenderedDebounceDelay ||\n        300);\n    }\n  }\n\n  handleAdViewed() {\n    this.core?.handleAdContainerViewed({\n      adClientResponseItem: this.adClientResponseItem,\n      adContainerId: this.adContainerId,\n      searchTerm: this.searchTerm || '',\n    });\n  }\n\n  /**\n   * Things to do when there's a new incoming search request.\n   */\n  handleNewIncomingSearchRequest(state: SearchcraftState) {\n    const requestProperties = state.searchClientRequestProperties;\n    if (requestProperties && typeof requestProperties === 'object') {\n      this.searchTerm = requestProperties.searchTerm;\n    }\n\n    this.searchResultCount = state.searchClientResponseItems.length;\n\n    this.handleAdRendered();\n\n    this.startIntersectionObserver();\n  }\n\n  onCoreAvailable(core: SearchcraftCore) {\n    const currentState = core.store.getState();\n\n    this.isComponentConnected = true;\n    this.core = currentState.core;\n    this.isSearchInProgress = currentState.isSearchInProgress;\n    this.searchResultCount = currentState.searchClientResponseItems.length;\n    this.timeTaken = currentState.searchResponseTimeTaken;\n\n    const requestProperties = currentState.searchClientRequestProperties;\n    if (requestProperties && typeof requestProperties === 'object') {\n      this.searchTerm = requestProperties.searchTerm;\n    }\n\n    /**\n     * Interstial ads have a different lifecycle, where we need handle an incoming search\n     * request immediately, because they are rendered alongside the search results.\n     */\n    if (this.renderPosition === 'interstitial') {\n      this.handleNewIncomingSearchRequest(currentState);\n    }\n\n    // Subscribes to store changes (for search term).\n    this.storeUnsubscribe = core.store.subscribe((state) => {\n      if (this.timeTaken !== state.searchResponseTimeTaken) {\n        this.handleNewIncomingSearchRequest(state);\n      }\n      this.timeTaken = state.searchResponseTimeTaken;\n      this.isSearchInProgress = state.isSearchInProgress;\n    });\n  }\n\n  connectedCallback() {\n    this.cleanupCore = registry.useCoreInstance(\n      this.searchcraftId,\n      this.onCoreAvailable.bind(this),\n    );\n  }\n\n  startIntersectionObserver() {\n    this.intersectionObserver?.disconnect();\n    /**\n     * Handles when an ad container is viewable within the document,\n     * Core emits an ad_container_viewed event and performs ad client side effects\n     */\n    if (this.hostElement) {\n      this.intersectionObserver = new IntersectionObserver(\n        ([entry]) => {\n          if (entry?.isIntersecting && this.searchResultCount > 0) {\n            this.handleAdViewed();\n          }\n        },\n        { threshold: 0 },\n      );\n\n      this.intersectionObserver.observe(this.hostElement);\n    }\n  }\n\n  disconnectedCallback() {\n    this.storeUnsubscribe?.();\n    this.cleanupCore?.();\n    this.intersectionObserver?.disconnect();\n    this.isComponentConnected = false;\n    clearTimeout(this.adContainerRenderedTimeout);\n  }\n\n  renderADMAd() {\n    const item = this.adClientResponseItem as ADMClientResponseItem;\n\n    if (!item.admAd) {\n      return;\n    }\n\n    let templateHtml = '<p>Ad Marketplace Ad Placeholder</p>';\n\n    if (this.core?.config?.admAdConfig?.template) {\n      templateHtml = this.core?.config?.admAdConfig.template(item.admAd, {\n        html,\n      });\n    }\n\n    return (\n      <div\n        class='searchcraft-ad searchcraft-adm-ad'\n        data-searchcraft-ad-container-id={this.adContainerId}\n        id={`searchcraft-adm-ad-${this.adContainerId}`}\n        innerHTML={templateHtml}\n      />\n    );\n  }\n\n  renderCustomAd() {\n    const templateRenderFunction = this.core?.config?.customAdConfig?.template;\n    const containerId = `searchcraft-custom-ad-${this.adContainerId}`;\n    let templateHtml = '<p>Custom Ad Placeholder</p>';\n\n    if (templateRenderFunction) {\n      templateHtml = templateRenderFunction(\n        {\n          searchTerm: this.searchTerm || '',\n          adContainerId: this.adContainerId,\n        },\n        { html },\n      );\n    }\n\n    return (\n      <div\n        class='searchcraft-ad searchcraft-custom-ad'\n        id={containerId}\n        data-searchcraft-ad-container-id={this.adContainerId}\n        innerHTML={templateHtml}\n      />\n    );\n  }\n\n  renderNativoAd() {\n    const nativoClassName =\n      this.core?.config.nativoConfig?.adClassName || 'ntv-item';\n    return (\n      <div\n        id={`searchcraft-native-ad-${this.adContainerId}`}\n        class={classNames('searchcraft-ad', nativoClassName)}\n        data-searchcraft-ad-container-id={this.adContainerId}\n      />\n    );\n  }\n\n  render() {\n    // Don't render ads if no search results\n    if (this.searchResultCount === 0) {\n      return;\n    }\n\n    switch (this.adSource) {\n      case 'adMarketplace':\n        return this.renderADMAd();\n      case 'Custom':\n        return this.renderCustomAd();\n      case 'Nativo':\n        return this.renderNativoAd();\n      default:\n        return;\n    }\n  }\n}\n"],"version":3}